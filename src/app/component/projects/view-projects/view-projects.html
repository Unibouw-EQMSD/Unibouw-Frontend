<app-header></app-header>
<main id="main">
  <div class="container">
    <!-- SKELETON LOADING -->
    <!-- FULL PAGE SKELETON -->
    <div class="full-page-skeleton" *ngIf="isLoading">
      <!-- LEFT SIDE SKELETON -->
      <div class="skeleton-left">
        <div class="skeleton-title skeleton"></div>

        <div class="skeleton-block" *ngFor="let x of [].constructor(7)">
          <div class="skeleton-label skeleton"></div>
          <div class="skeleton-value skeleton"></div>
        </div>
      </div>

      <!-- RIGHT SIDE SKELETON -->
      <div class="skeleton-right">
        <div class="skeleton-tabs">
          <div class="skeleton-tab skeleton"></div>
          <div class="skeleton-tab skeleton"></div>
          <div class="skeleton-tab skeleton"></div>
        </div>

        <div class="skeleton-table">
          <div class="skeleton-row" *ngFor="let r of [].constructor(6)">
            <div class="skeleton-cell skeleton" *ngFor="let c of [].constructor(6)"></div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!isLoading">
      <!-- Page Header -->
      <div class="pagetitle">
        <h1>
          <!-- <i
            class="fa fa-arrow-left arrow-left"
            aria-hidden="true"
            title="Back"
            (click)="goBack()"
          ></i> -->
          {{ projectDetails.name }}
        </h1>
      </div>

      <div class="project-details-container">
        <!-- LEFT: Project Details -->
        <div class="details-card" *ngIf="projectDetails">
          <div class="details-header">
            <h3>Details</h3>
          </div>

          <div class="details-content">
            <div class="detail-row">
              <span class="label">Project Code</span
              ><span class="value">{{ projectDetails.number }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Project</span><span class="value">{{ projectDetails.name }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Customer</span
              ><span class="value">{{ projectDetails.customerName }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Project Manager</span
              ><span class="value">{{ projectDetails.projectManagerName }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Start Date</span
              ><span class="value">{{ projectDetails.startDate | date : 'dd-MM-yyyy' }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Committed Date</span
              ><span class="value">{{ projectDetails.completionDate | date : 'dd-MM-yyyy' }}</span>
            </div>
            <div class="detail-row">
              <span class="label">Status</span>
              <span
                class="value status"
                [ngClass]="{
                  'status-started': projectDetails.status === 'Started',
                  'status-inprogress': projectDetails.status === 'In Progress',
                  'status-completed': projectDetails.status === 'Completed'
                }"
              >
                {{ projectDetails.status }}
              </span>
            </div>
            <div class="detail-row">
              <span class="label">Specification</span>
              <span class="value">
                <a [href]="projectDetails.sharepointURL" target="_blank">Project Files</a>
              </span>
            </div>
          </div>
        </div>

        <!-- RIGHT: TAB CONTENT -->
        <div class="rfq-card" *ngIf="!isLoading">
          <!-- ðŸ”¹ Tabs -->
          <div class="tabs">
            <button [class.active]="selectedTab === 'response'" (click)="selectedTab = 'response'">
              RFQ Response
            </button>

            <button [class.active]="selectedTab === 'rfq'" (click)="selectedTab = 'rfq'">
              RFQ
            </button>

            <button
              [class.active]="selectedTab === 'conversation'"
              (click)="selectedTab = 'conversation'; loadConversationSubcontractors()"
            >
              Conversation
            </button>
          </div>

          <!-- TAB 1: RFQ RESPONSE (Accordion Section) -->
          <div *ngIf="selectedTab === 'response'">
            <!-- GROUP OPTIONS -->
            <div class="rfq-header">
              <div class="group-options">
                <label class="cursor-pointer">
                  <input type="radio" name="groupBy" [(ngModel)]="groupBy" value="workItem" />
                  Group by Work Item
                </label>
                <label class="cursor-pointer">
                  <input
                    type="radio"
                    name="groupBy"
                    [(ngModel)]="groupBy"
                    value="subcontractor"
                    class="cursor-pointer"
                  />
                  Group by Subcontractor
                </label>
              </div>
            </div>
            <div class="text-center pt-20" *ngIf="isLoading">Loading...</div>

            <div class="table-scroll1">
              <!-- 1ï¸âƒ£  WORK ITEM GROUPING -->
              <div *ngIf="groupBy === 'workItem' && !isLoading" class="h-24">
                <!-- NO DATA (no work items) -->
                <div *ngIf="!workItems || workItems.length === 0" class="noData">
                  No RFQ responses available
                </div>
                <div *ngFor="let work of workItems" class="work-item">
                  <!-- Work Item Header -->
                  <div class="work-item-header" (click)="work.open = !work.open">
                    <div class="rfq-summary">
                      <div style="width: 100px">
                        <span class="label">Work Item</span>
                        <div class="highlight text-ellipsis" [title]="work.name">
                          {{ work.name }}
                        </div>
                      </div>
                      <div>
                        <span class="label">Requests Sent</span>
                        <div>{{ work.requestsSent }}</div>
                      </div>
                      <div>
                        <span class="label">Viewed</span>
                        <div>{{ work.viewed }}</div>
                      </div>
                      <div>
                        <span class="label">Interested</span>
                        <div>{{ work.interested }}</div>
                      </div>
                      <div>
                        <span class="label">Not Interested</span>
                        <div>{{ work.notInterested }}</div>
                      </div>
                      <div>
                        <span class="label">Maybe Later</span>
                        <div>{{ work.maybeLater }}</div>
                      </div>
                      <div>
                        <span class="label">Not Responded</span>
                        <div>{{ work.notResponded }}</div>
                      </div>
                    </div>

                    <i class="fa" [ngClass]="work.open ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                  </div>

                  <!-- Work Item Body -->
                  <div class="work-item-body" *ngIf="work.open">
                    <!-- Search -->
                    <div class="search-box" style="margin-bottom: 12px">
                      <input type="text" [(ngModel)]="work.searchText" placeholder="Search" />
                    </div>

                    <!-- Table -->
                    <div class="rfq-table-wrapper">
                      <table class="rfq-table">
                        <thead>
                          <tr>
                            <th>Name</th>
                            <th>Date</th>
                            <th>RFQ ID</th>
                            <th style="text-align: center">Viewed</th>
                            <th style="text-align: center">Interested</th>
                            <th style="text-align: center">Maybe Later</th>
                            <th style="text-align: center">Quote Amount</th>
                            <th style="text-align: center">Actions</th>
                          </tr>
                        </thead>

                        <tbody>
                          <!-- Loop through RFQs -->
                          <tr *ngFor="let rfq of getFilteredRfqs(work)">
                            <!-- CHECK: Does this row have a Subcontractor? -->
                            <ng-container *ngIf="rfq.viewed; else noResponseTemplate">
                              <td (click)="markViewed(work, rfq)">
                                {{ rfq.name }}
                                <div class="rating">â˜… {{ rfq.rating }}</div>
                              </td>

                              <td (click)="markViewed(work, rfq)">{{ rfq.date }}</td>
                              <td (click)="markViewed(work, rfq)">{{ rfq.rfqNumber }}</td>

                              <td style="text-align: center" (click)="markViewed(work, rfq)">
                                <i class="fa fa-check-circle success" *ngIf="rfq.viewed"></i>
                                <!-- <i class="fa fa-times fail" *ngIf="!rfq.viewed"></i> -->
                              </td>

                              <td style="text-align: center" (click)="markViewed(work, rfq)">
                                <i class="fa fa-check-circle success" *ngIf="rfq.interested"></i>
                                <i class="fa fa-times fail" *ngIf="rfq.notInterested"></i>
                              </td>
                              <td style="text-align: center" (click)="markMaybeLater(work, rfq)">
                                <i class="fa fa-check-circle success" *ngIf="rfq.maybeLater"></i>
                                <!-- <i class="fa fa-times fail" *ngIf="!rfq.maybeLater"></i> -->
                              </td>
                              <td
                                style="text-align: right; padding-right: 56px"
                                (click)="markViewed(work, rfq)"
                              >
                                <ng-container *ngIf="rfq.quoteAmount && rfq.quoteAmount !== '-'">
                                  {{
                                    rfq.quoteAmount
                                      | currency : 'EUR' : 'symbol' : '1.2-2' : 'nl-NL'
                                  }}
                                </ng-container>
                              </td>
                              <td style="text-align: center; padding-left: 20px">
                                <!-- PDF Icon with Disabled Logic -->
                                <i
                                  class="fa fa-file-pdf action-icon download-icon"
                                  [class.disabled-icon]="!isPdfEnabled(rfq)"
                                  (click)="
                                    isPdfEnabled(rfq) && downloadQuote($event, rfq.documentId)
                                  "
                                  title="Download Quote"
                                ></i>

                                <i
                                  class="fa fa-bell"
                                  [class.disabled-icon]="!isBellEnabled(rfq)"
                                  (click)="isBellEnabled(rfq) && openReminderPopup(rfq)"
                                  title="Set Reminder"
                                ></i>
                              </td>
                            </ng-container>

                            <!-- FALLBACK: If RFQ exists but no Subcontractor (e.g. RFQ59) -->
                            <ng-template #noResponseTemplate>
                              <td
                                colspan="9"
                                class="no-records-cell"
                                style="text-align: center; padding: 20px; color: #888"
                              >
                                No responses found
                              </td>
                            </ng-template>
                          </tr>

                          <!-- EDGE CASE: Filter returns 0 results completely -->
                          <tr *ngIf="getFilteredRfqs(work)?.length === 0">
                            <td
                              colspan="9"
                              class="no-records-cell"
                              style="text-align: center; padding: 20px; color: #888"
                            >
                              No responses found
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <!-- 2ï¸âƒ£ SUBCONTRACTOR GROUPING  -->
              <div *ngIf="groupBy === 'subcontractor' && !isLoading">
                <!-- NO DATA (no work items) -->
                <div
                  *ngIf="!subcontractorGroups || subcontractorGroups.length === 0"
                  class="noData"
                >
                  No RFQ responses available
                </div>

                <div *ngFor="let sub of subcontractorGroups" class="work-item">
                  <!-- Header -->
                  <div class="work-item-header" (click)="sub.open = !sub.open">
                    <div class="rfq-summary">
                      <div>
                        <span class="label">Subcontractor</span>
                        <div class="highlight">{{ sub.subcontractorName }}</div>
                      </div>
                      <div>
                        <span class="label">Requests Sent</span>
                        <div>{{ sub.requestsSent }}</div>
                      </div>
                      <div>
                        <span class="label">Viewed</span>
                        <div>{{ sub.viewed }}</div>
                      </div>
                      <div>
                        <span class="label">Interested</span>
                        <div>{{ sub.interested }}</div>
                      </div>
                      <div>
                        <span class="label">Not Interested</span>
                        <div>{{ sub.notInterested }}</div>
                      </div>
                      <div>
                        <span class="label">Maybe Later</span>
                        <div>{{ sub.maybeLater }}</div>
                      </div>
                      <div>
                        <span class="label">Not Responded</span>
                        <div>{{ sub.notResponded }}</div>
                      </div>
                    </div>

                    <i class="fa" [ngClass]="sub.open ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                  </div>

                  <!-- Body -->
                  <div class="work-item-body" *ngIf="sub.open">
                    <!-- Search -->
                    <div class="search-box" style="margin-bottom: 12px">
                      <input [(ngModel)]="sub.searchText" placeholder="Search" />
                    </div>

                    <!-- Table -->
                    <div class="rfq-table-wrapper">
                      <table class="rfq-table">
                        <thead>
                          <tr>
                            <th>Work Item</th>
                            <th>Date</th>
                            <th>RFQ ID</th>
                            <th style="text-align: center">Viewed</th>
                            <th style="text-align: center">Interested</th>
                            <th style="text-align: center">Maybe Later</th>
                            <th style="text-align: center">Quote Amount</th>
                            <th>Actions</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr *ngFor="let w of sub.workItems" (click)="markViewed(sub, w)">
                            <td>{{ w.workItemName }}</td>
                            <td>{{ w.date }}</td>
                            <td>{{ w.rfqNumber }}</td>
                            <td style="text-align: center">
                              <i class="fa fa-check-circle success" *ngIf="w.viewed"></i>
                              <!-- <i class="fa fa-times fail" *ngIf="!w.viewed"></i> -->
                            </td>

                            <td style="text-align: center">
                              <i class="fa fa-check-circle success" *ngIf="w.interested"></i>
                              <i class="fa fa-times fail" *ngIf="w.notInterested"></i>
                            </td>
                            <td style="text-align: center">
                              <i class="fa fa-check-circle success" *ngIf="w.maybeLater"></i>
                              <!-- <i class="fa fa-times fail" *ngIf="!w.maybeLater"></i> -->
                            </td>
                            <td style="text-align: right; padding-right: 50px">
                              <!-- â‚¬ {{ rfq.quoteAmount }} -->
                              <ng-container *ngIf="w.quoteAmount && w.quoteAmount !== '-'">
                                {{
                                  w.quoteAmount | currency : 'EUR' : 'symbol' : '1.2-2' : 'nl-NL'
                                }}
                              </ng-container>
                            </td>
                            <td style="text-align: center">
                              <i
                                class="fa fa-file-pdf action-icon download-icon"
                                *ngIf="w.actions?.includes('pdf')"
                                [class.disabled-icon]="!isPdfEnabled(w)"
                                (click)="w.documentId && downloadQuote($event, w.documentId)"
                                [title]="w.responded ? 'Download Quote' : 'No Quote Uploaded'"
                              ></i>
                              <i
                                class="fa fa-bell"
                                [class.disabled-icon]="!isBellEnabled(w)"
                                (click)="isBellEnabled(w) && openReminderPopup(w)"
                                title="Set Reminder"
                              ></i>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- TAB 2: RFQ (Mat Table Section) -->
          <div *ngIf="selectedTab === 'rfq'">
            <div class="button-container">
              <button type="button" class="addbtn" (click)="addRfq()">
                <b>Add RFQ</b>
              </button>
            </div>
            <div class="table-scroll">
              <table
                mat-table
                [dataSource]="dataSource"
                class="mat-elevation-z8"
                matSort
                matSortActive="workitem"
                matSortDirection="desc"
              >
                <tr class="mat-row" *matNoDataRow>
                  <td
                    class="mat-cell noData"
                    style="
                      border-bottom: none !important;
                      text-align: center;
                      padding-top: 90px;
                      font-size: 15px;
                    "
                    [attr.colspan]="displayedColumns.length"
                  >
                    No RFQs available.
                  </td>
                </tr>
                 <ng-container matColumnDef="number">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>RFQ ID</th>
                  <td mat-cell *matCellDef="let row">{{ row.number }}</td>
                </ng-container>
                <ng-container matColumnDef="workitem">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>WorkItem</th>
                  <td mat-cell *matCellDef="let row">{{ row.workItem }}</td>
                </ng-container>

                <ng-container matColumnDef="rfqSentDate">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Sent Date</th>
                  <td mat-cell *matCellDef="let row">{{ row.rfqSentDate }}</td>
                </ng-container>
                <ng-container matColumnDef="dueDate">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Due Date</th>

                  <td mat-cell *matCellDef="let row">{{ row.dueDate }}</td>
                </ng-container>

                <ng-container matColumnDef="totalSubcontractors">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>No. of Subcontractors</th>
                  <td mat-cell *matCellDef="let row">{{ row.subcontractorCount }}</td>
                </ng-container>
                <ng-container matColumnDef="quoteRecieved">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Quote Recieved</th>
                  <td mat-cell *matCellDef="let row">{{ row.quoteReceived }}</td>
                </ng-container>
                <ng-container matColumnDef="status">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
                  <td mat-cell *matCellDef="let row">{{ row.status }}</td>
                </ng-container>

                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Actions</th>
                  <td mat-cell *matCellDef="let row">
                    <i
                      class="fa-regular fa-pen-to-square edit-icon"
                      style="color: #f97316; cursor: pointer"
                      (click)="editRfq(row.id)"
                      title="Edit RFQ"
                    ></i>
                    <i
                      class="fa-regular fa-trash-can delete-icon"
                      (click)="deleteRfq(row.id)"
                      style="color: #dc3545; cursor: pointer; margin-left: 12px"
                      title="Delete RFQ"
                    ></i>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
              </table>
            </div>
          </div>
          <mat-paginator
            *ngIf="selectedTab === 'rfq'"
            [pageSize]="pageSize"
            [pageSizeOptions]="pageSizeOptions"
            showFirstLastButtons
          >
          </mat-paginator>
          <!-- TAB 3: CONVERSATION -->
          <div *ngIf="selectedTab === 'conversation'">
            <div class="noData" *ngIf="!convoSubcontractors || convoSubcontractors.length === 0">
              No Conversation.
            </div>
            <div class="chat-container" *ngIf="(convoSubcontractors?.length ?? 0) > 0">
              <!-- LEFT SIDEBAR -->
              <div class="chat-sidebar">
                <div class="sidebar-list" *ngIf="(convoSubcontractors?.length ?? 0) > 0">
                  <div
                    class="sidebar-item"
                    *ngFor="let sub of convoSubcontractors ?? []; let i = index"
                    [class.active]="selectedIndex === i"
                    (click)="onSubClick(sub.id, i)"
                  >
                    {{ sub.name }}
                  </div>
                </div>

                <!-- Button moved to bottom -->
                <button class="log-btn" (click)="openLogConvo()">Log conversation</button>
              </div>

              <!-- RIGHT CHAT AREA -->
              <div class="chat-content">
                <!-- Loader -->
                <div *ngIf="isSpinLoading" class="chat-loader">
                  <mat-spinner diameter="40"></mat-spinner>
                </div>

                <ng-container *ngIf="!isLoading">
                  <!-- Scrollable MESSAGES -->
                  <div class="chat-messages" #chatMessages>
                    <!-- No Data -->
                    <div
                      class="noData"
                      *ngIf="
                        !isSpinLoading &&
                        (!pmSubConversationData || pmSubConversationData.length === 0)
                      "
                    >
                      No Conversation
                    </div>

                    <!-- Chat Messages -->
                    <div
                      class="message-row"
                      *ngFor="let convo of pmSubConversationData"
                      [ngClass]="convo.senderType === 'PM' ? 'right' : 'left'"
                    >
                      <!-- Subcontractor Meta -->
                      <ng-container *ngIf="convo.senderType !== 'PM'">
                        <div class="message-meta">
                          <!-- Date/Time -->
                          <span class="message-time">
                            {{ convo.messageDateTime | date : 'MMM d, y h:mm a' }}
                          </span>

                          <!-- Conversation Type Icon -->
                          <ng-container [ngSwitch]="convo.conversationType?.toLowerCase()">
                            <i
                              *ngSwitchCase="'phone'"
                              class="fa fa-phone convoType-icon"
                              aria-hidden="true"
                            ></i>
                            <i
                              *ngSwitchCase="'email'"
                              class="fa fa-envelope convoType-icon"
                              aria-hidden="true"
                            ></i>
                            <i
                              *ngSwitchCase="'meeting'"
                              class="fa-sharp fa-regular fa-handshake convoType-icon"
                              aria-hidden="true"
                            ></i>
                            <ng-container *ngSwitchDefault></ng-container>
                          </ng-container>

                          <!-- Reply Button -->
                          <button class="reply-btn">Reply</button>
                        </div>
                      </ng-container>

                      <!-- PM Meta -->
                      <ng-container *ngIf="convo.senderType === 'PM'">
                        <span class="message-time">
                          {{ convo.messageDateTime | date : 'MMM d, y h:mm a' }}
                        </span>
                      </ng-container>

                      <!-- Message Bubble -->
                      <div class="message" [ngClass]="convo.senderType === 'PM' ? 'user' : 'bot'">
                        <!-- {{ convo.messageText }} -->
                        {{ convo.messageText || convo.message || convo.Message }}
                      </div>
                    </div>
                  </div>
                </ng-container>
                <!-- INPUT AREA -->
                <div class="chat-input">
                  <!-- Row 1: Attachments -->
                  <div class="attachment-row" *ngIf="attachments.length">
                    <div class="file-chip" *ngFor="let file of attachments; let i = index">
                      {{ file.name }}
                      <span class="remove" (click)="removeFile(i)" title="Remove">âœ•</span>
                    </div>
                  </div>

                  <!-- Row 2: Subject + Message + Actions -->
                  <div class="input-row">
                    <input
                      type="text"
                      class="subject-input"
                      placeholder="Enter Subject"
                      [(ngModel)]="subject"
                    />

                    <input
                      type="text"
                      class="message-input"
                      placeholder="Enter your message..."
                      [(ngModel)]="messageText"
                    />

                    <!-- Hidden file input -->
                    <input
                      type="file"
                      #fileInput
                      multiple
                      hidden
                      (change)="onFileSelected($event)"
                    />

                    <!-- Attach icon -->
                    <i
                      class="fa fa-paperclip attach-icon"
                      title="Attach"
                      (click)="fileInput.click()"
                    ></i>

                    <!-- Send icon -->
                    <i class="fa fa-paper-plane send-icon" title="Send" (click)="sendMessage()"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Reminder Popup Modal -->
  <div class="custom-modal-backdrop" *ngIf="showReminderPopup"></div>
  <div class="custom-modal" *ngIf="showReminderPopup">
    <div class="modal-content-box max-w-[53vw] bg-white rounded-lg shadow-lg p-6">
      <!-- Modal Header -->
      <div class="modal-header p-2 border-b border-gray-200">
        <p class="text-xl font-semibold">Settings</p>
      </div>
      <div class="loading-overlay" *ngIf="isLoading">
        <p>Sending Reminder...</p>
      </div>
      <!-- Modal Body -->
      <div class="modal-body space-y-6 px-4 pt-6 pb-3" *ngIf="!isLoading">
        <div class="modal-section">
          <!-- Due Date Box -->
          <div class="due-date-box">
            <div class="due-date-icon">
              <i class="fa fa-clock"></i>
            </div>

            <div class="due-date-content">
              <span class="due-date-label">Due Date</span>
              <span class="due-date-value">{{ dueDate }}</span>
            </div>
          </div>

          <!-- Radio buttons -->
          <div class="reminder-radio-row">
            <label class="radio-label" style="cursor: pointer">
              <input type="radio" name="reminderType" value="default" [(ngModel)]="reminderType" />
              <span>Default Reminder</span>
            </label>

            <label class="radio-label" style="cursor: pointer">
              <input type="radio" name="reminderType" value="custom" [(ngModel)]="reminderType" />
              <span>Custom Reminder</span>
            </label>
          </div>

          <!-- Default Reminder -->
          <div class="default-reminder-container" *ngIf="reminderType === 'default'">
            <div class="date-row" *ngFor="let d of reminderDates; let i = index">
              <span class="circle">{{ i + 1 }}</span>
              <!-- <span class="date-input">{{ d }}</span> -->
              <span class="date-input">
                {{ d.split('-')[2] }}-{{ d.split('-')[1] }}-{{ d.split('-')[0] }}
              </span>
            </div>
          </div>

          <!-- Custom Reminder -->
          <div class="reminder-container" *ngIf="reminderType === 'custom'">
            <div class="date-row" *ngFor="let date of customReminderDates; let i = index">
              <span class="circle">{{ i + 1 }}</span>
              <input
                [matDatepicker]="picker"
                class="date-input"
                placeholder="Select date"
                [(ngModel)]="customReminderDates[i]"
                [min]="minDate"
                [max]="maxDate"
              />

              <mat-datepicker-toggle matSuffix [for]="picker">
                <i class="fa fa-calendar calendar-icon"></i>
              </mat-datepicker-toggle>
              <span class="delete-icon" title="Remove" (click)="removeCustomDate(i)">x</span>
              <mat-datepicker #picker></mat-datepicker>
            </div>

            <i class="far fa-calendar-plus calendar-add" title="Add" (click)="addCustomDate()"></i>
          </div>

          <!-- Time Picker -->
          <div class="time-row">
            <label>Set Time: </label>
            <input type="time" class="time-input readonly-bg" [value]="reminderTime" readonly />
            <i class="fa fa-clock-o time-icon"></i>
          </div>
        </div>

        <!-- Email Body -->
        <div class="modal-section">
          <label class="email-label">Email Body</label>
          <textarea
            class="reminder-body"
            rows="4"
            [(ngModel)]="reminderEmailBody"
            [readonly]="reminderType === 'default'"
            [ngClass]="{ 'readonly-bg': reminderType === 'default' }"
            >{{ reminderEmailBody }}
         </textarea
          >
        </div>
      </div>

      <!-- Modal Footer -->
      <div class="modal-footer">
        <button class="btn cancel-btn" (click)="closeReminderPopup()">Cancel</button>
        <button
          class="btn reset-btn"
          *ngIf="reminderType === 'custom'"
          (click)="resetReminderPopup()"
        >
          Reset
        </button>
        <button class="btn submit-btn" (click)="sendReminder()">Send Reminder</button>
      </div>
    </div>
  </div>
</main>
<app-footer></app-footer>

<!-- Log Conversation Popup Modal -->
<div class="custom-modal-backdrop" *ngIf="showLogConvoPopup"></div>

<div class="custom-modal" *ngIf="showLogConvoPopup">
  <div class="modal-content-box">
    <!-- Modal Header -->
    <div class="modal-header">
      <p class="modal-title">Log Conversation</p>
      <!-- Close Icon -->
      <button class="modal-close" title="Close" (click)="closeLogConvo()" aria-label="Close">
        &times;
      </button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      <!-- Conversation Type-->
      <div class="row">
        <label class="label">Conversation Type</label>
        <div class="time-wrapper">
          <select class="drop-down-type" [(ngModel)]="conversationType">
            <option>Email</option>
            <option>Meeting</option>
            <option>Phone</option>
            <option>Other</option>
          </select>
        </div>
      </div>

      <!-- Date & Time -->
      <div class="row">
        <label class="label">Date & Time</label>
        <div class="time-wrapper">
          <input type="datetime-local" class="date-time-input" [(ngModel)]="conversationDateTime" />
        </div>
      </div>
      <!-- Add Subject -->
      <div class="modal-section">
        <label class="label block">Subject</label>
        <input type="text" class="input-text" [(ngModel)]="conversationSubject" />
      </div>
      <!-- Add Conversation -->
      <div class="modal-section">
        <label class="label block">Add Conversation</label>
        <textarea class="add-convo-textarea" rows="4" [(ngModel)]="conversationText"></textarea>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="btn cancel-btn" (click)="closeLogConvo()">Cancel</button>
      <button class="btn reset-btn" (click)="resetLogConvo()">Reset</button>
      <button class="btn submit-btn" (click)="saveLogConvo()">Save</button>
    </div>
  </div>
</div>
