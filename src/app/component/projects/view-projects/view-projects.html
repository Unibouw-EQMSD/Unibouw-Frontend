<app-header></app-header>
<main id="main">
  <div class="container">
    <!-- ðŸ”¹ Page Header -->
    <div class="pagetitle">
      <h1>{{ projectDetails.name }}</h1>
    </div>

    <div class="project-details-container">
      <!-- LEFT: Project Details -->
      <div class="details-card" *ngIf="projectDetails">
        <div class="details-header">
          <h3>Details</h3>
        </div>

        <div class="details-content">
          <div class="detail-row">
            <span class="label">Project Code</span
            ><span class="value">{{ projectDetails.number }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Project</span><span class="value">{{ projectDetails.name }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Customer</span
            ><span class="value">{{ projectDetails.customerName }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Project Manager</span
            ><span class="value">{{ projectDetails.projectManagerName }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Start Date</span
            ><span class="value">{{ projectDetails.startDate | date : 'dd-MM-yyyy' }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Committed Date</span
            ><span class="value">{{ projectDetails.completionDate | date : 'dd-MM-yyyy' }}</span>
          </div>
          <!-- <div class="detail-row">
        <span class="label">Status</span>
        <span class="value status">{{ projectDetails.status }}</span>
      </div> -->
          <div class="detail-row">
            <span class="label">Status</span>
            <span
              class="value status"
              [ngClass]="{
                'status-started': projectDetails.status === 'Started',
                'status-inprogress': projectDetails.status === 'In Progress',
                'status-completed': projectDetails.status === 'Completed'
              }"
            >
              {{ projectDetails.status }}
            </span>
          </div>

          <div class="detail-row">
            <span class="label">Total Dimension</span
            ><span class="value">{{ projectDetails.totalDimension }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Specification</span>
            <span class="value">
              <a [href]="projectDetails.sharepointURL" target="_blank">Project Files</a>
            </span>
          </div>
        </div>
      </div>

      <div *ngIf="isLoading" class="loading">Loading project details...</div>

      <!-- RIGHT: TAB CONTENT -->
      <div class="rfq-card">
        <!-- ðŸ”¹ Tabs -->
        <div class="tabs">
          <button [class.active]="selectedTab === 'response'" (click)="selectedTab = 'response'">
            RFQ Response
          </button>

          <button [class.active]="selectedTab === 'rfq'" (click)="selectedTab = 'rfq'">RFQ</button>

          <button
            [class.active]="selectedTab === 'conversation'"
            (click)="selectedTab = 'conversation'"
          >
            Conversation
          </button>
        </div>

        <!-- ðŸŸ¢ TAB 1: RFQ RESPONSE (Accordion Section) -->
        <div *ngIf="selectedTab === 'response'">
          <div class="rfq-header">
            <!-- <h3>RFQ Responses</h3> -->
            <div class="group-options">
              <label
                ><input type="radio" name="groupBy" [(ngModel)]="groupBy" value="workItem" /> Group
                by Work Item</label
              >
              <label
                ><input type="radio" name="groupBy" [(ngModel)]="groupBy" value="subcontractor" />
                Group by Subcontractor</label
              >
            </div>
          </div>

          <div *ngFor="let work of workItems" class="work-item">
            <div class="work-item-header" (click)="work.open = !work.open">
              <div class="rfq-summary">
                <div>
                  <span class="label">Work Item</span>
                  <div class="highlight">{{ work.name }}</div>
                </div>
                <div>
                  <span class="label">Requests Sent</span>
                  <div>{{ work.requestsSent }}</div>
                </div>
                <div>
                  <span class="label">Not Responded</span>
                  <div>{{ work.notResponded }}</div>
                </div>
                <div>
                  <span class="label">Interested</span>
                  <div>{{ work.interested }}</div>
                </div>
                <div>
                  <span class="label">Not Interested</span>
                  <div>{{ work.notInterested }}</div>
                </div>
                <div>
                  <span class="label">Viewed</span>
                  <div>{{ work.viewed }}</div>
                </div>
              </div>
              <div>
                <i class="fa" [ngClass]="work.open ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
              </div>
            </div>

            <div class="work-item-body" *ngIf="work.open">
              <div class="search-box" style="margin-bottom: 12px">
                <input type="text" [(ngModel)]="work.searchText" placeholder="Search" />
              </div>

              <div class="rfq-table-wrapper">
                <table class="rfq-table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Date</th>
                      <th>RFQ ID</th>
                      <th>Responded</th>
                      <th>Interested</th>
                      <th>Viewed</th>
                      <th>Quote Status</th>
                      <th>Quote Amount</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr *ngFor="let rfq of getFilteredRfqs(work)" (click)="markViewed(work, rfq)">
                      <td>
                        {{ rfq.name }}
                        <div class="rating">â˜… {{ rfq.rating }}</div>
                      </td>
                      <td>{{ rfq.date }}</td>
                      <td>{{ rfq.rfqId }}</td>
                      <td><i class="fa fa-check-circle success" *ngIf="rfq.responded"></i></td>
                      <td><i class="fa fa-check-circle success" *ngIf="rfq.interested"></i></td>
                      <td><i class="fa fa-check-circle success" *ngIf="rfq.viewed"></i></td>
                      <td>{{ rfq.responded ? 'Uploaded' : 'Not Uploaded' }}</td>
                      <td>{{ rfq.quoteAmount || '-' }}</td>

                      <td>
                        <i
                          *ngIf="rfq.actions?.includes('pdf')"
                          class="fa fa-file-pdf action-icon download-icon"
                          (click)="downloadQuote($event, rfq.rfqId, rfq.subcontractorId)"
                          title="Download"
                        ></i>
                        <i *ngIf="rfq.actions?.includes('lock')" class="fa fa-lock action-icon"></i>
                        <i
                          class="fa fa-bell"
                          title="Set Reminder"
                          (click)="openReminderPopup(rfq)"
                        ></i>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- ðŸ”µ TAB 2: RFQ (Mat Table Section) -->
        <div *ngIf="selectedTab === 'rfq'">
          <button type="button" class="addbtn" (click)="addRfq()">
            <b>Add RFQ</b>
          </button>
          <table
            mat-table
            [dataSource]="dataSource"
            class="mat-elevation-z8"
            matSort
            matSortActive="customer"
            matSortDirection="asc"
          >
            <ng-container matColumnDef="workitem">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>WorkItem</th>
              <td mat-cell *matCellDef="let row">{{ row.workItem }}</td>
            </ng-container>

            <ng-container matColumnDef="rfqSentDate">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Sent Date</th>
              <td mat-cell *matCellDef="let row">{{ row.rfqSentDate }}</td>
            </ng-container>
            <ng-container matColumnDef="dueDate">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Due Date</th>

              <td mat-cell *matCellDef="let row">{{ row.dueDate }}</td>
            </ng-container>

            <ng-container matColumnDef="totalSubcontractors">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>No. of Subcontractors</th>
              <td mat-cell *matCellDef="let row">{{ row.subcontractorCount }}</td>
            </ng-container>

            <!-- <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef> Actions </th>
          <td mat-cell *matCellDef="let row">
            <i class="fa-regular fa-pen-to-square edit-icon"></i>
          </td>
        </ng-container> -->

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
          </table>
        </div>

        <mat-paginator
          *ngIf="selectedTab === 'rfq'"
          [pageSize]="pageSize"
          [pageSizeOptions]="pageSizeOptions"
          showFirstLastButtons
        >
        </mat-paginator>

        <!-- ðŸŸ£ TAB 3: CONVERSATION -->
        <div *ngIf="selectedTab === 'conversation'">
          <h3>Conversation</h3>
          <p>No messages yet.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Reminder Popup Modal -->
  <div class="custom-modal-backdrop" *ngIf="showReminderPopup"></div>

  <!-- <div class="custom-modal" *ngIf="showReminderPopup">
    <div class="modal-content-box">
      <p class="modal-header">Set Reminder</p>

      <div class="modal-content">
        <textarea class="reminder-body" readonly rows="7" style="width: 100%; margin-bottom: 16px">
Dear Subcontractor,

This is a reminder to upload your quote before the due date. Please ensure all required documents are submitted on time.

Thank you.</textarea
        >
      </div>

      <div style="display: flex; justify-content: flex-end; gap: 12px">
        <button class="btn cancel-btn" (click)="closeReminderPopup()">Cancel</button>
        <button class="btn submit-btn" (click)="sendReminder()">Send</button>
      </div>
    </div>
  </div> -->

  <div class="custom-modal" *ngIf="showReminderPopup">
    <div class="modal-content-box" style="max-width: 53vw">
      <p class="modal-header" style="font-size: 20px; font-weight: 500; margin-bottom: 24px">
        Send Reminder
      </p>

      <div class="modal-section" style="margin-bottom: 30px">
        <div
          style="
            background: #f2f7fd;
            border-radius: 8px;
            padding: 16px 24px;
            margin-bottom: 25px;
            border: 1px solid #e4eeff;
            display: flex;
            align-items: flex-start;
            gap: 12px;
          "
        >
          <!-- Column 1: Icon -->
          <div style="color: #1d6fe8; font-size: 20px; margin-top: 10px">
            <i class="fa fa-clock"></i>
          </div>

          <!-- Column 2: Due date text and actual date -->
          <div style="display: flex; flex-direction: column; gap: 4px">
            <span style="color: #1d6fe8; font-size: 16px; font-weight: 500">Due Date</span>
            <span style="color: #222; font-size: 16px">30-12-2025</span>
          </div>
        </div>

        <div style="display: flex; align-items: center; gap: 18px">
          <label style="display: flex; align-items: center">
            <input type="radio" name="reminderType" value="default" [(ngModel)]="reminderType" />
            <span style="margin-left: 6px">Default Reminder</span>
          </label>

          <label style="display: flex; align-items: center">
            <input type="radio" name="reminderType" value="custom" [(ngModel)]="reminderType" />
            <span style="margin-left: 6px">Custom Reminder</span>
          </label>
        </div>

        <!-- Default Reminder -->
        <div class="default-reminder-container" *ngIf="reminderType === 'default'">
          <div class="date-row">
            <span class="circle">1</span>
            <span class="date-input">15-11-2025</span>
          </div>
          <div class="date-row">
            <span class="circle">2</span>
            <span class="date-input">15-12-2025</span>
          </div>
          <div class="date-row">
            <span class="circle">3</span>
            <span class="date-input">15-12-2025</span>
          </div>
        </div>

        <!-- Custom Reminder -->
        <div class="reminder-container" *ngIf="reminderType === 'custom'">
          <div class="date-row">
            <span class="circle">1</span>

            <input [matDatepicker]="picker1" class="date-input" placeholder="Select date" />

            <mat-datepicker-toggle matSuffix [for]="picker1">
              <i class="fa fa-calendar calendar-icon"></i>
            </mat-datepicker-toggle>

            <mat-datepicker #picker1></mat-datepicker>
          </div>

          <div class="date-row">
            <span class="circle">2</span>

            <input [matDatepicker]="picker2" class="date-input" placeholder="Select date" />

            <mat-datepicker-toggle matSuffix [for]="picker2">
              <i class="fa fa-calendar calendar-icon"></i>
            </mat-datepicker-toggle>

            <mat-datepicker #picker2></mat-datepicker>
          </div>

          <div class="date-row">
            <span class="circle">3</span>

            <input [matDatepicker]="picker3" class="date-input" placeholder="Select date" />

            <mat-datepicker-toggle matSuffix [for]="picker3">
              <i class="fa fa-calendar calendar-icon"></i>
            </mat-datepicker-toggle>

            <mat-datepicker #picker3></mat-datepicker>
          </div>

          <div class="date-row">
            <span class="circle">4</span>

            <input [matDatepicker]="picker4" class="date-input" placeholder="Select date" />

            <mat-datepicker-toggle matSuffix [for]="picker4">
              <i class="fa fa-calendar calendar-icon"></i>
            </mat-datepicker-toggle>

            <mat-datepicker #picker4></mat-datepicker>
          </div>
        </div>

        <!-- Set timer -->
        <div class="time-row mt-8">
          <label>Set Time: </label>
          <input type="time" class="time-input" />
          <i class="fa fa-clock-o time-icon"></i>
        </div>
      </div>

      <div class="modal-section" style="margin-bottom: 20px">
        <label style="font-weight: 500; margin-bottom: 8px; display: block">Email Body</label>
        <textarea
          class="reminder-body"
          rows="5"
          style="padding: 10px; width: 100%; resize: none; border: 1px solid #d9dee3"
        >
Dear Subcontractor,
This is a reminder to upload your quote before the due date. Please ensure all required documents are submitted on time.
Thank you.
      </textarea
        >
      </div>

      <div
        style="
          display: flex;
          justify-content: flex-end;
          gap: 18px;
          border-top: 1px solid #eee;
          padding-top: 16px;
        "
      >
        <button
          class="btn cancel-btn"
          style="color: #f95c0f; background: none; border: none; font-weight: 500; font-size: 15px"
          (click)="closeReminderPopup()"
        >
          Cancel
        </button>
        <button
          class="btn submit-btn"
          style="background: #f95c0f; color: white; font-weight: 500; font-size: 15px"
          (click)="sendReminder()"
        >
          Send Reminder
        </button>
      </div>
    </div>
  </div>
</main>
<app-footer></app-footer>
