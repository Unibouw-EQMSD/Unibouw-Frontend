<app-header></app-header>
<main id="main">
  <div class="container">
    <div class="pagetitle">
      <h1>Projects</h1>
    </div>

    <!-- ðŸ¦´ Skeleton Loader -->
    <div *ngIf="!isSkeletonLoading" class="skeleton-container">
      <div class="skeleton-box"></div>
    </div>

    <!-- ðŸ“‹ Table Section -->
    <div class="table-container" *ngIf="isSkeletonLoading">
      <!-- ðŸ” Search -->
      <mat-form-field appearance="fill" class="search-box full-width">
        <input matInput [(ngModel)]="searchText" (input)="applyFilter()" placeholder="Search" />
        <button
          matSuffix
          mat-icon-button
          *ngIf="searchText"
          (click)="searchText = ''; applyFilter()"
        >
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <div class="table-scroll">
        <table
          mat-table
          [dataSource]="dataSource"
          class="mat-elevation-z2 full-width-table"
          matSort
          matSortActive="name"
          matSortDirection="asc"
        >
          <!-- Columns (same as yours) -->
          <!-- Code -->
          <ng-container matColumnDef="number">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Code</th>
            <td mat-cell *matCellDef="let item">{{ item.number }}</td>
          </ng-container>

          <!-- Name -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
            <td mat-cell *matCellDef="let item">{{ item.name }}</td>
          </ng-container>

          <!-- Customer -->
          <ng-container matColumnDef="customerName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Customer</th>
            <td mat-cell *matCellDef="let item">{{ item.customerName }}</td>
          </ng-container>

          <!-- Project Manager -->
          <ng-container matColumnDef="projectManagerName">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Project Manager</th>
            <td mat-cell *matCellDef="let item">{{ item.projectManagerName }}</td>
          </ng-container>

          <!-- Start Date -->
          <ng-container matColumnDef="startDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Start</th>
            <td mat-cell *matCellDef="let item">{{ item.startDate | date : 'dd-MM-yyyy' }}</td>
          </ng-container>

          <!-- Committed Date -->
          <ng-container matColumnDef="completionDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Committed</th>
            <td mat-cell *matCellDef="let item">{{ item.completionDate | date : 'dd-MM-yyyy' }}</td>
          </ng-container>

          <!-- Status -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
            <td mat-cell *matCellDef="let item">
              <span
                [ngClass]="{
                  'status-started': item.status === 'Started',
                  'status-inprogress': item.status === 'In Progress',
                  'status-completed': item.status === 'Completed'
                }"
              >
                {{ item.status }}
              </span>
            </td>
          </ng-container>

          <!-- Action -->
          <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef>Action</th>
            <td mat-cell *matCellDef="let item">
              <a
                [routerLink]="['/view-projects', item.projectID]"
                matTooltip="View Details"
                (click)="logProjectId(item.projectID)"
              >
                <mat-icon class="vis-icon" style="font-size: 20px !important">visibility</mat-icon>
              </a>
            </td>
          </ng-container>

          <!-- Header + Rows -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let item; columns: displayedColumns"
            (click)="navigateToProject(item)"
            class="clickable-row"
          ></tr>

          <tr *matNoDataRow>
            <td [attr.colspan]="displayedColumns.length || 1" class="table-spinner-cell">
              <!-- Show spinner only when loading -->
              <div *ngIf="isLoading">
                <mat-spinner diameter="40"></mat-spinner>
              </div>

              <!-- Show empty message only when there are no columns -->
              <div *ngIf="!isLoading && displayedColumns.length === 0" class="no-data-message">
                No projects found.
              </div>
            </td>
          </tr>
        </table>
      </div>

      <!-- ðŸ“„ Paginator -->
      <mat-paginator
        [pageSize]="pageSize"
        [pageSizeOptions]="pageSizeOptions"
        (page)="onPageSizeChange($event)"
        showFirstLastButtons
      >
      </mat-paginator>
    </div>
  </div>
</main>
<app-footer></app-footer>
