<app-header></app-header>
<main id="main">
  <div class="container">

    <!-- FULL PAGE SKELETON -->
    <div *ngIf="isSkeletonLoading" class="full-page-skeleton">
      <div class="skeleton-table-header2">
        <div class="skeleton th skeleton"></div>
        <div class="skeleton th skeleton"></div>
      </div>

      <!-- Search bar -->
      <div class="skeleton-search skeleton"></div>

      <!-- Table header -->
      <div class="skeleton-table-header3">
        <div class="skeleton th skeleton"></div>
        <div class="skeleton th skeleton"></div>
        <div class="skeleton th skeleton"></div>
      </div>

      <!-- Table rows -->
      <div class="skeleton-box"></div>
    </div>

    <!-- üìã Table Container -->
    <div class="" *ngIf="!isSkeletonLoading">

    <!-- üß© Header -->
    <div class="pagetitle">
      <div class="d-flex">
      <h1>{{ 'WORKITEM.TITLE' | translate }}</h1>
      <!-- üîç Search -->
      <mat-form-field appearance="fill" class="search-box full-width">
        <input
          matInput
          [(ngModel)]="searchText"
          (input)="applyFilter()"
          placeholder="{{ 'COMMON.SEARCH' | translate }}"
        />
        <button
          matSuffix
          mat-icon-button
          *ngIf="searchText"
          (click)="searchText = ''; applyFilter()"
          title="Clear"
        >
          <span class="search-clear"> √ó </span>
        </button>
      </mat-form-field>
    </div>
    </div>
      <div class="card">
        <div class="card-body p-0">
      <!-- üß≠ Tabs -->
      <div class="tabs">
        <button
          mat-button
          [ngClass]="{ active: activeTab === 'unibouw' }"
          (click)="setTab('unibouw')"
          class="unibouwLabel"
        >
          {{ 'WORKITEM.TAB_UNIBOUW' | translate }}
        </button>
        <button
          mat-button
          [ngClass]="{ active: activeTab === 'standard' }"
          (click)="setTab('standard')"
          class="standardLabel"
        >
          {{ 'WORKITEM.TAB_STANDARD' | translate }}
        </button>
      </div>

      <!-- üßæ Table -->
      <div class="table-Fixedheader-wrapper">
        <table
          mat-table
          [dataSource]="dataSource"
          matSort
          matSortActive="name"
          matSortDirection="asc"
          class="mat-elevation-z2 full-width-table"
        >
          <!-- ‚úÖ Number Column -->
          <ng-container matColumnDef="number">
            <th mat-header-cell *matHeaderCellDef mat-sort-header class="td-wicode">
              {{ 'WORKITEM.CODE' | translate }}
            </th>
            <td mat-cell *matCellDef="let item" class="td-wicode">{{ item.number }}</td>
          </ng-container>

          <!-- ‚úÖ Workitem Name Column -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{ 'WORKITEM.NAME' | translate }}
            </th>
            <td mat-cell *matCellDef="let item">{{ item.name }}</td>
          </ng-container>

          <!-- ‚úÖ Description Column -->
          <!-- <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Description</th>
          <td mat-cell *matCellDef="let item">
            <div class="input-wrapper-absolute">
              <input
                matInput
                [(ngModel)]="item.description"
                [readonly]="!item.isEditing || !item.isActive"
                class="description-input"
              />

              <button
                *ngIf="!item.isEditing"
                mat-icon-button
                class="edit-icon"
                (click)="item.isEditing = true"
                [disabled]="!item.isActive"
              >
                <mat-icon>edit</mat-icon>
              </button>

              <button
                *ngIf="item.isEditing"
                mat-icon-button
                class="tick-icon"
                (click)="saveDescription(item)"
              >
                <mat-icon>check</mat-icon>
              </button>
            </div>
          </td>
        </ng-container> -->

          <!-- ‚úÖ Action Column (Admin Only) -->
          <ng-container *ngIf="isAdmin" matColumnDef="action" class="actions">
            <th mat-header-cell *matHeaderCellDef>{{ 'COMMON.ACTIONS' | translate }}</th>
            <td mat-cell *matCellDef="let item" class="actions">
              <mat-slide-toggle
                class="toggle"
                color="primary"
                [checked]="item.isActive"
                (change)="toggleIsActive(item)"
              >
              </mat-slide-toggle>
            </td>
          </ng-container>

          <!-- ‚úÖ Header and Row Definitions -->
          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns"
            [class.hidden]="isLoading"
            class="sticky-header"
          ></tr>

          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            [class.hidden]="isLoading"
            [class.inactive]="!row.isActive"
          ></tr>

          <!-- Loading or No Data Row -->
          <tr *matNoDataRow>
            <td [attr.colspan]="displayedColumns.length" class="table-spinner-cell">
              <ng-container *ngIf="isLoading">
                <mat-spinner diameter="40"></mat-spinner>
              </ng-container>
              <ng-container *ngIf="!isLoading">
                <div class="no-data-message">No WorkItems found.</div>
              </ng-container>
            </td>
          </tr>
        </table>
      </div>

      <!-- üìÑ Paginator -->
      <mat-paginator
        [pageSize]="pageSize"
        [pageSizeOptions]="pageSizeOptions"
        showFirstLastButtons
        style="cursor: pointer"
      >
      </mat-paginator>
    </div>
    </div>
    </div>
  </div>
</main>
<!-- ‚úÖ Popup -->
<div *ngIf="showPopup" [ngClass]="{ popup: true, error: popupError }">
  <span *ngIf="!popupError">‚úÖ</span>
  <span *ngIf="popupError">‚ùå</span>
  {{ popupMessage }}
</div>

<app-footer></app-footer>
