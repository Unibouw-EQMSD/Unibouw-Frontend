<div class="container" *ngIf="!isLoading; else loading">
  <div class="page-header">
    <h1>Quote Request (RFQ)</h1>
  </div>

  <!-- <div class="rfq-status-banner" *ngIf="project">
  <span class="status-badge" [ngClass]="buttonsDisabled ? 'expired' : 'active'">
  {{ buttonsDisabled ? 'Expired' : 'Active' }}
</span>

<span class="banner-text">
 This RFQ link is valid until 
{{ (rfq?.globalDueDate || rfq?.dueDate) | date:'dd MMMM yyyy' }},
11:59 PM.
  After this, you will not be able to submit or change your response.
</span>
</div> -->

  <div class="rfq-layout" *ngIf="project; else errorBlock">
    <!-- LEFT CARD: Project Details -->
    <aside class="left-card">
      <div class="details-card" style="width:180px">
        <h3>Project Details</h3>
        <div class="detail-row">
          <span class="label">Project Code</span>
          <span class="value">{{ project.number || '—' }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Project</span>
          <span class="value">{{ project.name || '—' }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Customer</span>
          <span class="value">{{ project.company || '—' }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Project Manager</span>
          <span class="value">{{ project.projectManagerName || '—' }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Start Date</span>
          <span class="value">{{ project.startDate | date : 'dd-MM-yyyy' }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Committed Date</span>
          <span class="value">{{ project.completionDate | date : 'dd-MM-yyyy' }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Status</span>
          <span class="value status {{ statusClass(project.status) }}">
            {{ project.status || 'In Progress' }}
          </span>
        </div>
        <div class="detail-row" *ngIf="project.totalDimension">
          <span class="label">Total Dimension</span>
          <span class="value">{{ project.totalDimension }}</span>
        </div>
        <div class="detail-row" *ngIf="project.sharepointURL">
          <span class="label">Specification</span>
          <span class="value">
            <ng-container *ngFor="let file of project.sharepointURL.split(','); let last = last">
              <a [href]="file" target="_blank">{{ file.split('/').pop() }}</a><span *ngIf="!last">, </span>
            </ng-container>
          </span>
        </div>
      </div>
    </aside>

    <!-- RIGHT CARD: RFQ Details -->
    <section class="right-card" style="width:100%">
      <div class="panel">
        <div class="two-col">
          <div class="rfq-field">
            <label>Workitem Code</label>
            <input type="text" [value]="selectedWorkItem?.number || '—'" readonly />
          </div>
          <div class="rfq-field">
            <label>Workitem</label>
            <input type="text" [value]="selectedWorkItem?.name || '—'" readonly />
          </div>
        </div>
        <div style="margin: 18px 0 12px 0; border-bottom: 1px solid #ececec;"></div>
        <!-- Share your interest buttons row -->
        <div style="display: flex; align-items: center; justify-content: space-between; gap: 12px; margin-bottom:18px;">

  <!-- Left: Interest Buttons -->
  <div style="display: flex; align-items: center; gap: 12px;">
    <span style="font-weight:500; color:#22223b;">Share your Interest</span>
    <button class="btn-primary" type="button" (click)="submitInterest('Interested')" [disabled]="buttonsDisabled">
      Interested
    </button>
    <button class="btn-ghost" type="button" (click)="submitInterest('Maybe Later')" [disabled]="buttonsDisabled">
      Maybe Later
    </button>
    <button class="btn-ghost" type="button" (click)="submitInterest('Not Interested')" [disabled]="buttonsDisabled">
      Not Interested
    </button>
  </div>

  <!-- Right: Submit Quote Button -->
<button class="btn-primary" 
        type="button"  
        (click)="openQuotePanel()">
  {{ isQuoteSubmitted ? 'Resubmit Quote' : 'Submit Quote' }}
</button>

</div>


        <!-- Quote Details Panel -->
        <div *ngIf="showQuotePanel" class="quote-details-panel">
          <h4>Quote Details</h4>
          <div style="display: flex; gap: 18px; flex-wrap: wrap;">
            <!-- Previous Submissions -->
            <div style="flex:1.8;">
              <span style="font-weight:500; color:#22223b; font-size:15px;">Previous Submissions</span>
              <!-- Repeat this block for each previous quote -->
              <div class="previous-submission-row" *ngFor="let submission of previousSubmissions">
                <div>
                  <div class="submission-label">Submitted on</div>
                  <div class="submission-value">{{ submission.date | date:'dd-MM-yyyy' }}</div>
                </div>
                <div>
                  <div class="submission-label">Total Quote Amount</div>
                  <div class="submission-value">{{ submission.amount | currency:'USD' }}</div>
                </div>
                <div>
                  <div class="submission-label">Attachment</div>
                  <div class="submission-value">
                    <a (click)="downloadSubmission(submission)" style="cursor:pointer;">
                      <i class="fa fa-file-pdf attachment-icon"></i>
                    </a>
                  </div>
                </div>
                <div>
                  <div class="submission-label">Comment</div>
                 <div class="submission-value">
  <i class="fa fa-comment-dots comment-icon"
     (click)="openCommentModal(submission.comment)">
  </i>
</div>
                </div>
              </div>
              <!-- End repeat -->
            </div>
            <!-- Submit Quote Form -->
            <form [formGroup]="quoteForm" style="flex:1; min-width:260px;">

  <div class="rfq-field" *ngIf="rightSectionVisible">
    <label>Total Quote Amount</label>
    <input type="text" formControlName="quoteAmount" placeholder="Enter amount" />
  </div>

 <div class="rfq-field" *ngIf="rightSectionVisible">
  <label>Attachments</label>
  <div class="attachments-container">
    <input #fileInput type="file" (change)="onFileSelected($event)" />
    <button type="button" class="delete-btn" (click)="removeFile(fileInput)">
      <i class="fa fa-trash"></i>
    </button>
  </div>
</div>


  <div class="rfq-field" *ngIf="rightSectionVisible">
    <label>Comments</label>
    <textarea placeholder="Add Comments" rows="3" formControlName="comments"></textarea>
  </div>

  <div style="margin-top:10px; text-align:right;"  *ngIf="rightSectionVisible">
    <button class="btn-primary" type="button" (click)="submitQuoteFile()">Submit</button>
  </div>

</form>

          </div>
        </div>
        <!-- End Quote Details Panel -->
      </div>
    </section>
  </div>
</div>
<!-- ============================= -->
<!-- COMMENT MODAL -->
<!-- ============================= -->
<div class="comment-modal" *ngIf="showCommentModal">
  <div class="comment-modal-backdrop" (click)="closeCommentModal()"></div>

  <div class="comment-modal-content">
    <h3>Comments</h3>

    <div class="comment-text">
      {{ selectedComment || 'No comments available.' }}
    </div>

    <button class="close-btn" (click)="closeCommentModal()">Close</button>
  </div>
</div>

<!-- Loading/Error templates (unchanged) -->
<ng-template #loading>
  <div class="loading text-center p-5">
    <h3>Loading project details...</h3>
  </div>
</ng-template>
<ng-template #errorBlock>
  <div class="error text-center p-5 text-danger">
    <h3>{{ errorMsg || 'No data found for this RFQ.' }}</h3>
  </div>
</ng-template>