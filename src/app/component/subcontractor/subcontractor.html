<app-header></app-header>
<main id="main">
  <div class="container">
    <div class="pagetitle">
      <h1>Subcontractors</h1>

      <div class="skeleton-add skeleton" *ngIf="isSkeletonLoading"></div>
      <button
        type="button"
        class="addbtn"
        [routerLink]="['/add-subcontractor', projectID, projectName]"
        *ngIf="!isSkeletonLoading"
      >
        <b>Add Subcontractor</b>
      </button>
    </div>

    <!-- FULL PAGE SKELETON -->
    <div *ngIf="isSkeletonLoading" class="full-page-skeleton">
      <!-- Search bar -->
      <div class="skeleton-search skeleton"></div>

      <!-- Table header -->
      <div class="skeleton-table-header6">
        <div class="skeleton th skeleton"></div>
        <div class="skeleton th skeleton"></div>
        <div class="skeleton th skeleton"></div>
        <div class="skeleton th skeleton"></div>
        <div class="skeleton th skeleton"></div>
        <div class="skeleton th skeleton"></div>
      </div>

      <!-- Table rows -->
      <div class="skeleton-box"></div>
    </div>

    <!-- üìã TABLE CONTAINER -->
    <div class="table-container" *ngIf="!isSkeletonLoading">
      <!-- üîç Search -->
      <mat-form-field appearance="fill" class="search-box full-width">
        <input matInput [(ngModel)]="searchText" (input)="applyFilter()" placeholder="Search" />
        <button
          matSuffix
          mat-icon-button
          *ngIf="searchText"
          (click)="searchText = ''; applyFilter()"
        >
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <!-- üßæ Table -->
      <div class="table-scroll">
        <table
          mat-table
          [dataSource]="dataSource"
          matSort
          matSortActive="name"
          class="mat-elevation-z2 full-width-table"
        >
          <!-- ‚úÖ Actual Data Columns -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
            <td mat-cell *matCellDef="let item">{{ item.name }}</td>
          </ng-container>

          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Workitem</th>
            <td mat-cell *matCellDef="let item">
              <span class="truncate-text" [matTooltip]="item.category">{{ item.category }}</span>
            </td>
          </ng-container>

          <ng-container matColumnDef="contactNumber">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Contact Number</th>
            <td mat-cell *matCellDef="let item">{{ item.phoneNumber1 }}</td>
          </ng-container>

          <ng-container matColumnDef="contactPerson">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Contact Person</th>
            <td mat-cell *matCellDef="let item">{{ item.personName }}</td>
          </ng-container>

          <ng-container matColumnDef="emailId">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Email</th>
            <td mat-cell *matCellDef="let item">{{ item.emailID }}</td>
          </ng-container>

          <ng-container *ngIf="isAdmin" matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef>Action</th>
            <td mat-cell *matCellDef="let item">
              <mat-slide-toggle
                color="primary"
                class="toggle"
                [checked]="item.isActive"
                (change)="toggleIsActive(item)"
              >
              </mat-slide-toggle>
            </td>
          </ng-container>

          <!-- ‚úÖ Header and Data Rows (Hide during load or no data) -->
          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns"
            [class.hidden]="isLoading"
            class="sticky-header"
          ></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            [class.hidden]="isLoading"
            [class.inactive]="!row.isActive"
          ></tr>

          <!-- ‚úÖ Loading or No Data Row -->
          <tr *matNoDataRow>
            <td [attr.colspan]="displayedColumns.length" class="table-spinner-cell">
              <ng-container *ngIf="isLoading">
                <mat-spinner diameter="40"></mat-spinner>
              </ng-container>
              <ng-container *ngIf="!isLoading">
                <div class="no-data-message">No subcontractors found.</div>
              </ng-container>
            </td>
          </tr>
        </table>
      </div>

      <!-- üìÑ Paginator -->
      <mat-paginator
        [pageSize]="pageSize"
        [pageSizeOptions]="pageSizeOptions"
        (page)="onPageSizeChange($event)"
        showFirstLastButtons
      >
      </mat-paginator>

      <!-- <div class="record-count" *ngIf="!isLoading && dataSource.data.length > 0">
    Showing {{ getStartIndex() }} ‚Äì {{ getEndIndex() }} of {{ dataSource.data.length }} entries
  </div> -->
    </div>
  </div>
</main>
<!-- ‚úÖ Popup -->
<div *ngIf="showPopup" [ngClass]="{ popup: true, error: popupError }">
  <span *ngIf="!popupError">‚úÖ</span>
  <span *ngIf="popupError">‚ùå</span>
  {{ popupMessage }}
</div>
<app-footer></app-footer>
