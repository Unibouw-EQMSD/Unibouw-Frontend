<app-header></app-header>
<main id="main">
  <div class="container">
    <!-- FULL PAGE SKELETON -->
    <div *ngIf="isSkeletonLoading" class="full-page-skeleton">
      <!-- Search bar -->
      <div class="skeleton-search skeleton"></div>

      <!-- Table header -->
      <div class="skeleton-table-header6">
        <div class="skeleton th skeleton"></div>
        <div class="skeleton th skeleton"></div>
        <div class="skeleton th skeleton"></div>
        <div class="skeleton th skeleton"></div>
        <div class="skeleton th skeleton"></div>
        <div class="skeleton th skeleton"></div>
      </div>

      <!-- Table rows -->
      <div class="skeleton-box"></div>
    </div>

    <!-- üìã TABLE CONTAINER -->
    <div class="" *ngIf="!isSkeletonLoading">
      <div class="pagetitle">
        <div class="d-flex">
          <h1>{{ 'SUBCONTRACTOR.TITLE' | translate }}</h1>
          <!-- üîç Search -->
          <mat-form-field appearance="fill" class="search-box full-width">
            <input
              matInput
              [(ngModel)]="searchText"
              (input)="applyFilter()"
              placeholder="{{ 'COMMON.SEARCH' | translate }}"
            />
            <button
              matSuffix
              mat-icon-button
              *ngIf="searchText"
              (click)="searchText = ''; applyFilter()"
              title="Clear"
            >
              <span class="search-clear"> √ó </span>
            </button>
          </mat-form-field>
        </div>

        <div class="skeleton-add skeleton" *ngIf="isSkeletonLoading"></div>
        <button
          type="button"
          class="addbtn"
          [routerLink]="['/add-subcontractor', projectID, projectName, projectCode]"
          *ngIf="!isSkeletonLoading">
          <b>{{ 'SUBCONTRACTOR.ADD' | translate }}</b>
        </button>
      </div>

      <div class="card">
        <div class="card-body p-0">
      <!-- üßæ Table -->
      <div class="table-Fixedheader-wrapper">
        <table
          mat-table
          [dataSource]="dataSource"
          matSort
          matSortActive="name"
          matSortDirection="asc"
          matSortDisableClear
          class="mat-elevation-z2 full-width-table"
        >
          <!-- ‚úÖ Actual Data Columns -->
          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{ 'SUBCONTRACTOR.NAME' | translate }}
            </th>
            <td mat-cell *matCellDef="let item"><span class="truncate-text" [matTooltip]="item.name">{{ item.name }}</span></td>
          </ng-container>

          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{ 'SUBCONTRACTOR.WORKITEMS' | translate }}
            </th>
            <td mat-cell *matCellDef="let item">
              <span class="truncate-text" [matTooltip]="item.category"><span class="truncate-text" [matTooltip]="item.category">{{ item.category }}</span></span>
            </td>
          </ng-container>

          <ng-container matColumnDef="contactNumber">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{ 'SUBCONTRACTOR.PHONE' | translate }}
            </th>
            <td mat-cell *matCellDef="let item"><span class="truncate-text" [matTooltip]="">{{ item.contactPhone }}</span></td>
          </ng-container>

          <ng-container matColumnDef="contactPerson">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{ 'SUBCONTRACTOR.PERSON' | translate }}
            </th>
            <td mat-cell *matCellDef="let item"><span class="truncate-text" [matTooltip]="item.contactName">{{ item.contactName }}</span></td>
          </ng-container>

          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>
              {{ 'SUBCONTRACTOR.EMAIL' | translate }}
            </th>
            <td mat-cell *matCellDef="let item"><span class="truncate-text" [matTooltip]="item.email">{{ item.email }}</span></td>
          </ng-container>

          <ng-container *ngIf="isAdmin" matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef>{{ 'COMMON.ACTIONS' | translate }}</th>
            <td mat-cell *matCellDef="let item">
              <!-- Eye icon button for view -->
              <button
                mat-icon-button
                (click)="viewSubcontractorDetails(item.subcontractorID)"
                title="View"
              >
                <mat-icon class="vis-icon">visibility</mat-icon
                >
              </button>
              <!-- Slide toggle for isActive (stop event bubbling) -->
              <mat-slide-toggle
                color="primary"
                class="toggle"
                [checked]="item.isActive"
                (click)="$event.stopPropagation()"
                (change)="toggleIsActive(item)"
                style="margin-left: 10px"
              >
              </mat-slide-toggle>
            </td>
          </ng-container>

          <!-- ‚úÖ Header and Data Rows (Hide during load or no data) -->
          <tr
            mat-header-row
            *matHeaderRowDef="displayedColumns"
            [class.hidden]="isLoading"
            class="sticky-header"
          ></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            [class.hidden]="isLoading"
            [class.inactive]="!row.isActive"
            (click)="viewSubcontractorDetails(row.subcontractorID)"
            style="cursor: pointer"
            class="clickable-row"
          ></tr>

          <!-- ‚úÖ Loading or No Data Row -->
          <tr *matNoDataRow>
            <td [attr.colspan]="displayedColumns.length" class="table-spinner-cell">
              <ng-container *ngIf="isLoading">
                <mat-spinner diameter="40"></mat-spinner>
              </ng-container>
              <ng-container *ngIf="!isLoading">
                <div class="no-data-message">{{ 'MESSAGES.NO_SUBCONTRACTORS' | translate }}</div>
              </ng-container>
            </td>
          </tr>
        </table>
      </div>

      <!-- üìÑ Paginator -->
      <mat-paginator
        [pageSize]="pageSize"
        [pageSizeOptions]="pageSizeOptions"
        (page)="onPageSizeChange($event)"
        showFirstLastButtons
      >
      </mat-paginator>

      <!-- <div class="record-count" *ngIf="!isLoading && dataSource.data.length > 0">
    Showing {{ getStartIndex() }} ‚Äì {{ getEndIndex() }} of {{ dataSource.data.length }} entries
  </div> -->
    </div>
    </div>
    </div>
  </div>
</main>
<!-- ‚úÖ Popup -->
<div *ngIf="showPopup" [ngClass]="{ popup: true, error: popupError }">
  <span *ngIf="!popupError">‚úÖ</span>
  <span *ngIf="popupError">‚ùå</span>
  {{ popupMessage }}
</div>
<app-footer></app-footer>
